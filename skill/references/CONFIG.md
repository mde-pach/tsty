# Configuration Reference

Complete guide to Tsty configuration file (`.tsty/config.json`).

---

## Table of Contents

1. [Overview](#overview)
2. [Complete JSON Schema](#complete-json-schema)
3. [Field Reference](#field-reference)
4. [Configuration Examples](#configuration-examples)
5. [Viewport Configuration](#viewport-configuration)
6. [Playwright Settings](#playwright-settings)
7. [Best Practices](#best-practices)

---

## Overview

The configuration file (`.tsty/config.json`) is automatically created by `tsty init` and stores:
- Base URL for tests
- Credentials for authentication
- Viewport sizes for responsive testing
- Playwright browser settings
- Global defaults

**Location**: `.tsty/config.json` (or legacy `.qa-testing/config.json`)

**Auto-created**: Run `tsty init` to generate default config

---

## Complete JSON Schema

```json
{
  "baseUrl": "string (required) - Base URL for all tests",
  "credentials": {
    "email": "string (optional) - Test account email",
    "password": "string (optional) - Test account password",
    "username": "string (optional) - Test account username",
    "apiKey": "string (optional) - API key for testing"
  },
  "viewports": {
    "desktop": {
      "width": "number (optional, default: 1920)",
      "height": "number (optional, default: 1080)"
    },
    "tablet": {
      "width": "number (optional, default: 768)",
      "height": "number (optional, default: 1024)"
    },
    "mobile": {
      "width": "number (optional, default: 375)",
      "height": "number (optional, default: 667)"
    }
  },
  "playwright": {
    "headless": "boolean (optional, default: true)",
    "timeout": "number (optional, default: 30000)",
    "browser": "string (optional, default: 'chromium') - chromium|firefox|webkit",
    "slowMo": "number (optional, default: 0) - Slow down operations by N ms",
    "args": ["string[] (optional) - Browser launch arguments"]
  },
  "screenshots": {
    "quality": "number (optional, default: 90) - JPEG quality 0-100",
    "type": "string (optional, default: 'png') - png|jpeg"
  }
}
```

---

## Field Reference

### Base Configuration

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `baseUrl` | string | ‚úÖ Yes | - | Base URL for all relative URLs in tests |
| `credentials` | object | No | {} | Authentication credentials |
| `viewports` | object | No | See below | Viewport sizes for device testing |
| `playwright` | object | No | See below | Playwright browser settings |
| `screenshots` | object | No | See below | Screenshot capture settings |

### Credentials Object

| Field | Type | Description |
|-------|------|-------------|
| `email` | string | Test account email (accessible via `${credentials.email}`) |
| `password` | string | Test account password (accessible via `${credentials.password}`) |
| `username` | string | Test account username |
| `apiKey` | string | API key for authenticated requests |

**Usage in flows**:
```json
{
  "type": "fill",
  "selector": "input[name='email']",
  "value": "${credentials.email}"
}
```

### Viewport Configuration

Default viewports:
```json
{
  "viewports": {
    "desktop": { "width": 1920, "height": 1080 },
    "tablet": { "width": 768, "height": 1024 },
    "mobile": { "width": 375, "height": 667 }
  }
}
```

**Usage**:
```bash
tsty run my-flow --device desktop
tsty run my-flow --device tablet
tsty run my-flow --device mobile
```

### Playwright Settings

| Field | Type | Default | Description |
|-------|------|---------|-------------|
| `headless` | boolean | true | **Run browser in headless mode (REQUIRED for autonomous/agentic testing)** |
| `timeout` | number | 30000 | Default timeout in milliseconds |
| `browser` | string | 'chromium' | Browser to use (chromium, firefox, webkit) |
| `slowMo` | number | 0 | Slow down operations by N ms (for debugging) |
| `args` | string[] | [] | Browser launch arguments |

**‚ö†Ô∏è Headless Mode:**
- **`true` (default)**: No visible browser window - **USE THIS for autonomous/agentic testing**
- **`false`**: Visible browser window - ONLY for manual debugging/development

### Screenshot Settings

| Field | Type | Default | Description |
|-------|------|---------|-------------|
| `quality` | number | 90 | JPEG quality (0-100, only for JPEG type) |
| `type` | string | 'png' | Screenshot format (png or jpeg) |

---

## Configuration Examples

### Example 1: Basic Configuration (Default)

Auto-generated by `tsty init`:

```json
{
  "baseUrl": "http://localhost:3000",
  "credentials": {
    "email": "test@example.com",
    "password": "password123"
  },
  "viewports": {
    "desktop": { "width": 1920, "height": 1080 },
    "tablet": { "width": 768, "height": 1024 },
    "mobile": { "width": 375, "height": 667 }
  },
  "playwright": {
    "headless": true,
    "timeout": 30000
  }
}
```

**Use case**: Standard local development testing

---

### Example 2: Non-Headless Mode (Debugging)

See browser while tests run:

```json
{
  "baseUrl": "http://localhost:3000",
  "playwright": {
    "headless": false,
    "timeout": 30000,
    "slowMo": 100
  }
}
```

**Benefits**:
- Watch tests execute in real browser
- Debug visually
- Slow down actions with `slowMo`
- Easier to identify issues

**When to use**:
- Debugging failing tests
- Understanding test flow
- Visual verification
- Learning Playwright behavior

---

### Example 3: Multi-Environment Setup

Different configs for dev/staging/prod:

**`.tsty/config.json`** (development):
```json
{
  "baseUrl": "http://localhost:3000",
  "credentials": {
    "email": "dev@example.com",
    "password": "devpass123"
  },
  "playwright": {
    "headless": false,
    "timeout": 30000
  }
}
```

**`.tsty/config.staging.json`** (staging):
```json
{
  "baseUrl": "https://staging.example.com",
  "credentials": {
    "email": "staging@example.com",
    "password": "stagingpass123"
  },
  "playwright": {
    "headless": true,
    "timeout": 60000
  }
}
```

**Usage**:
```bash
# Development (uses config.json)
tsty run my-flow

# Staging (would need custom env handling)
BASE_URL=https://staging.example.com tsty run my-flow
```

---

### Example 4: Custom Viewports

Test specific device sizes:

```json
{
  "baseUrl": "http://localhost:3000",
  "viewports": {
    "desktop": { "width": 1920, "height": 1080 },
    "laptop": { "width": 1366, "height": 768 },
    "tablet": { "width": 768, "height": 1024 },
    "mobile": { "width": 375, "height": 667 },
    "iphone14": { "width": 390, "height": 844 },
    "ipadPro": { "width": 1024, "height": 1366 }
  }
}
```

**Usage**:
```bash
tsty run my-flow --device iphone14
tsty run my-flow --device ipadPro
```

---

### Example 5: Firefox Browser

Test with Firefox instead of Chromium:

```json
{
  "baseUrl": "http://localhost:3000",
  "playwright": {
    "browser": "firefox",
    "headless": true,
    "timeout": 30000
  }
}
```

**Supported browsers**:
- `chromium` (default) - Chrome/Edge
- `firefox` - Firefox
- `webkit` - Safari

**Install browsers**:
```bash
npx playwright install chromium
npx playwright install firefox
npx playwright install webkit
```

---

### Example 6: Custom Browser Arguments

Pass additional Chrome flags:

```json
{
  "baseUrl": "http://localhost:3000",
  "playwright": {
    "headless": true,
    "timeout": 30000,
    "args": [
      "--disable-web-security",
      "--disable-features=IsolateOrigins,site-per-process",
      "--no-sandbox"
    ]
  }
}
```

**Common args**:
- `--disable-web-security` - Disable CORS (testing only!)
- `--no-sandbox` - Required for some CI environments
- `--disable-dev-shm-usage` - Fix memory issues in Docker
- `--window-size=1920,1080` - Set window size

**‚ö†Ô∏è Warning**: Only use these for testing, not production!

---

### Example 7: Long Timeout for Slow Tests

Increase timeout for slow networks:

```json
{
  "baseUrl": "http://localhost:3000",
  "playwright": {
    "headless": true,
    "timeout": 120000
  }
}
```

**When to increase timeout**:
- Slow API responses
- Large file uploads
- Complex page renders
- Network latency

**Default**: 30000ms (30 seconds)

---

### Example 8: Screenshot Configuration

Optimize screenshot storage:

```json
{
  "baseUrl": "http://localhost:3000",
  "screenshots": {
    "type": "jpeg",
    "quality": 80
  }
}
```

**Trade-offs**:
- **PNG** (default): Lossless, larger files (~500KB-2MB)
- **JPEG**: Lossy, smaller files (~100KB-500KB)

**When to use JPEG**:
- Large test suites (save disk space)
- CI/CD with limited storage
- Screenshots don't need perfect quality

**When to use PNG**:
- Visual regression testing (need exact comparison)
- Text-heavy screenshots (avoid JPEG artifacts)
- Default is fine (storage not an issue)

---

### Example 9: Production Testing

Configuration for testing production sites:

```json
{
  "baseUrl": "https://example.com",
  "credentials": {
    "email": "prod-test@example.com",
    "password": "secure-prod-password"
  },
  "playwright": {
    "headless": true,
    "timeout": 60000,
    "browser": "chromium"
  },
  "screenshots": {
    "type": "jpeg",
    "quality": 85
  }
}
```

**Considerations**:
- Use separate test accounts
- Longer timeout for network latency
- JPEG screenshots to save bandwidth
- Headless mode for CI/CD

---

### Example 10: API Key Authentication

For apps that use API keys:

```json
{
  "baseUrl": "https://api.example.com",
  "credentials": {
    "apiKey": "sk_test_1234567890abcdef",
    "clientId": "client_xyz",
    "clientSecret": "secret_abc"
  }
}
```

**Usage in actions**:
```json
{
  "type": "setExtraHTTPHeaders",
  "options": {
    "Authorization": "Bearer ${credentials.apiKey}"
  }
}
```

---

## Viewport Configuration

### Standard Device Sizes

| Device | Width | Height | DPI | Notes |
|--------|-------|--------|-----|-------|
| Desktop | 1920 | 1080 | 1x | Full HD desktop |
| Laptop | 1366 | 768 | 1x | Standard laptop |
| Tablet | 768 | 1024 | 2x | iPad portrait |
| Mobile | 375 | 667 | 2x | iPhone SE/8 |
| iPhone 14 | 390 | 844 | 3x | Modern iPhone |
| iPad Pro | 1024 | 1366 | 2x | iPad Pro 12.9" |

### Responsive Testing Strategy

**Test 3 sizes minimum**:
1. **Mobile** (375px) - Smallest supported size
2. **Tablet** (768px) - Breakpoint between mobile/desktop
3. **Desktop** (1920px) - Full desktop experience

**Run tests**:
```bash
# Test all three
tsty run my-flow --device mobile
tsty run my-flow --device tablet
tsty run my-flow --device desktop
```

---

## Playwright Settings

### Headless vs Non-Headless

**‚ö†Ô∏è CRITICAL: Use `headless: true` for all autonomous/agentic testing**

**Headless** (`headless: true` - default & recommended):
- ‚úÖ **REQUIRED for autonomous/agentic testing**
- ‚úÖ No visible browser windows
- ‚úÖ Faster execution
- ‚úÖ Lower resource usage
- ‚úÖ CI/CD compatible
- ‚úÖ Background execution
- ‚úÖ Essential for automated workflows

**Non-Headless** (`headless: false` - manual debugging ONLY):
- ‚ö†Ô∏è **DO NOT USE for autonomous testing**
- üëÅÔ∏è Visible browser window
- üêõ Only for manual debugging
- üêå Slower execution
- üíª Requires display/GUI environment

### Timeout Guidelines

| Scenario | Recommended Timeout |
|----------|---------------------|
| Fast local tests | 10000ms (10s) |
| Standard tests | 30000ms (30s) |
| Slow API calls | 60000ms (60s) |
| File uploads | 120000ms (120s) |

**Override per step**:
```json
{
  "name": "Slow step",
  "timeout": 60000
}
```

---

## Best Practices

### 1. Use Environment-Specific Configs

‚ùå **DON'T**: Hardcode production URLs in config
```json
{
  "baseUrl": "https://production.example.com"
}
```

‚úÖ **DO**: Use localhost by default, override in CI/CD
```json
{
  "baseUrl": "http://localhost:3000"
}
```

Then in CI:
```bash
BASE_URL=https://staging.example.com tsty run my-flow
```

### 2. Keep Credentials Secure

‚ùå **DON'T**: Commit real passwords
```json
{
  "credentials": {
    "password": "MyRealPassword123!"
  }
}
```

‚úÖ **DO**: Use test accounts with limited permissions
```json
{
  "credentials": {
    "email": "test-account@example.com",
    "password": "test-only-password"
  }
}
```

**Better**: Use environment variables in CI:
```bash
TEST_EMAIL=ci-test@example.com TEST_PASSWORD=ci-pass tsty run
```

### 3. Add `.tsty/config.json` to `.gitignore`

If config contains sensitive data:
```bash
echo ".tsty/config.json" >> .gitignore
```

**Then provide template**:
```json
// .tsty/config.example.json
{
  "baseUrl": "http://localhost:3000",
  "credentials": {
    "email": "YOUR_EMAIL_HERE",
    "password": "YOUR_PASSWORD_HERE"
  }
}
```

### 4. Use Reasonable Timeouts

‚ùå **DON'T**: Use extremely long timeouts
```json
{
  "playwright": {
    "timeout": 300000  // 5 minutes!
  }
}
```

‚úÖ **DO**: Use appropriate timeouts per scenario
```json
{
  "playwright": {
    "timeout": 30000  // 30 seconds default
  }
}

// Override in specific steps
{
  "name": "Upload large file",
  "timeout": 120000  // 2 minutes only for this step
}
```

### 5. Optimize Screenshot Settings

**For visual regression** (need exact comparison):
```json
{
  "screenshots": {
    "type": "png"
  }
}
```

**For general testing** (save disk space):
```json
{
  "screenshots": {
    "type": "jpeg",
    "quality": 85
  }
}
```

---

## Initialization

### Create Default Config

```bash
# Initialize in current directory
tsty init

# Creates .tsty/config.json with defaults
```

### Verify Config

```bash
# Check config exists
cat .tsty/config.json

# Test with a flow
tsty run my-test
```

---

## Cross-References

- **Flow Structure**: See [FLOW-STRUCTURE.md](FLOW-STRUCTURE.md) for using baseUrl in flows
- **Variables**: See [VARIABLES.md](VARIABLES.md) for using credentials variables
- **Examples**: See [EXAMPLES.md](EXAMPLES.md) for complete flow examples
- **CLI**: See [CLI-REFERENCE.md](CLI-REFERENCE.md) for overriding config via CLI

---

**Last Updated**: 2026-02-06
